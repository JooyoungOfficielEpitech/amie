<!DOCTYPE html>
<html>
<head>
    <title>매칭 웹소켓 테스트</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #console { height: 400px; overflow-y: auto; background-color: #f0f0f0; padding: 10px; border-radius: 5px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { margin: 5px; padding: 10px; }
        input { padding: 8px; width: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Amié 매칭 웹소켓 테스트</h1>
        
        <div>
            <label for="token">토큰:</label>
            <input type="text" id="token" placeholder="JWT 토큰 입력">
            <button onclick="connectSocket()">연결</button>
            <button onclick="disconnectSocket()">연결 해제</button>
        </div>
        
        <h3>매칭 기능</h3>
        <div>
            <button onclick="requestMatching()">매칭 요청</button>
            <button onclick="checkMatchStatus()">매칭 상태 확인</button>
            <button onclick="cancelMatching()">매칭 취소</button>
        </div>
        
        <h3>로그</h3>
        <div id="console"></div>
    </div>

    <script>
        let socket;
        let matchSocket;
        
        function log(message) {
            const consoleDiv = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function connectSocket() {
            try {
                const token = document.getElementById('token').value;
                if (!token) {
                    log('⚠️ 토큰을 입력하세요');
                    return;
                }
                
                log('🔌 서버에 연결 중...');
                
                // 기본 소켓 연결
                socket = io('http://localhost:3001', {
                    auth: {
                        token: token
                    }
                });
                
                socket.on('connect', () => {
                    log('✅ 메인 소켓 연결 성공');
                });
                
                socket.on('connect_error', (err) => {
                    log(`❌ 연결 오류: ${err.message}`);
                });
                
                // 매칭 네임스페이스 연결
                matchSocket = io('http://localhost:3001/match', {
                    auth: {
                        token: token
                    }
                });
                
                matchSocket.on('connect', () => {
                    log('✅ 매칭 소켓 연결 성공');
                });
                
                matchSocket.on('connect_error', (err) => {
                    log(`❌ 매칭 소켓 연결 오류: ${err.message}`);
                });
                
                // 매칭 관련 이벤트 리스너 등록
                matchSocket.on('matchStatus', (data) => {
                    log(`📊 매칭 상태 업데이트: ${JSON.stringify(data)}`);
                });
                
                matchSocket.on('matchFound', (data) => {
                    log(`✨ 매칭 찾음: ${JSON.stringify(data)}`);
                });
                
                matchSocket.on('matchCancelled', (data) => {
                    log(`🚫 매칭 취소됨: ${JSON.stringify(data)}`);
                });
                
                matchSocket.on('error', (error) => {
                    log(`❌ 매칭 에러: ${error}`);
                });
            } catch (error) {
                log(`❌ 연결 오류: ${error.message}`);
            }
        }
        
        function disconnectSocket() {
            if (matchSocket) {
                matchSocket.disconnect();
                log('🔌 매칭 소켓 연결 해제');
            }
            
            if (socket) {
                socket.disconnect();
                log('🔌 메인 소켓 연결 해제');
            }
        }
        
        function requestMatching() {
            if (!matchSocket || !matchSocket.connected) {
                log('⚠️ 매칭 소켓이 연결되어 있지 않습니다');
                return;
            }
            
            log('🔍 매칭 요청 중...');
            matchSocket.emit('request-match', {}, (response) => {
                log(`📣 매칭 요청 응답: ${JSON.stringify(response)}`);
            });
        }
        
        function checkMatchStatus() {
            if (!matchSocket || !matchSocket.connected) {
                log('⚠️ 매칭 소켓이 연결되어 있지 않습니다');
                return;
            }
            
            log('🔍 매칭 상태 확인 중...');
            matchSocket.emit('check-match-status', {}, (response) => {
                log(`📣 매칭 상태: ${JSON.stringify(response)}`);
            });
        }
        
        function cancelMatching() {
            if (!matchSocket || !matchSocket.connected) {
                log('⚠️ 매칭 소켓이 연결되어 있지 않습니다');
                return;
            }
            
            log('🚫 매칭 취소 중...');
            matchSocket.emit('cancel-match', {}, (response) => {
                log(`📣 매칭 취소 응답: ${JSON.stringify(response)}`);
            });
        }
    </script>
</body>
</html> 